// 使用 Free Dictionary API 获取单词详情
// https://dictionaryapi.dev/

import { Word, Meaning } from '../../types'

interface DictionaryResponse {
  word: string
  phonetics: Array<{
    text?: string
    audio?: string
  }>
  meanings: Array<{
    partOfSpeech: string
    definitions: Array<{
      definition: string
      example?: string
      synonyms?: string[]
      antonyms?: string[]
    }>
    synonyms?: string[]
    antonyms?: string[]
  }>
}

// 简单的中文翻译映射（常见词汇）
const commonTranslations: Record<string, string> = {
  'abandon': '放弃，抛弃',
  'ability': '能力，才能',
  'able': '能够的，有能力的',
  'about': '关于，大约',
  'above': '在...上方',
  'accept': '接受，承认',
  'according': '根据，按照',
  'account': '账户，解释',
  'achieve': '达到，实现',
  'action': '行动，活动',
  'activity': '活动，行为',
  'actually': '实际上，事实上',
  'add': '添加，增加',
  'address': '地址，演说',
  'administration': '管理，行政',
  'admit': '承认，准许进入',
  'adult': '成年人，成人的',
  'affect': '影响，感动',
  'after': '在...之后',
  'again': '再次，又',
  'against': '反对，对着',
  'age': '年龄，时代',
  'agency': '代理，机构',
  'agent': '代理人，特工',
  'ago': '以前',
  'agree': '同意，赞成',
  'agreement': '协议，一致',
  'ahead': '在前面，提前',
  'air': '空气，空中',
  'all': '所有的，全部',
  'allow': '允许，准许',
  'almost': '几乎，差不多',
  'alone': '单独的，独自',
  'along': '沿着，一起',
  'already': '已经',
  'also': '也，同样',
  'although': '虽然，尽管',
  'always': '总是，一直',
  'american': '美国的，美国人',
  'among': '在...之中',
  'amount': '数量，总额',
  'analysis': '分析，解析',
  'and': '和，与',
  'animal': '动物',
  'another': '另一个',
  'answer': '回答，答案',
  'any': '任何的',
  'anyone': '任何人',
  'anything': '任何事物',
  'appear': '出现，似乎',
  'apply': '申请，应用',
  'approach': '方法，接近',
  'area': '区域，领域',
  'argue': '争论，认为',
  'arm': '手臂，武器',
  'around': '围绕，大约',
  'arrive': '到达',
  'art': '艺术',
  'article': '文章，物品',
  'artist': '艺术家',
  'as': '作为，当...时',
  'ask': '问，要求',
  'assume': '假设，承担',
  'at': '在',
  'attack': '攻击，进攻',
  'attention': '注意，关注',
  'attorney': '律师',
  'audience': '观众，听众',
  'author': '作者',
  'authority': '权威，当局',
  'available': '可用的，有空的',
  'avoid': '避免',
  'away': '离开，远离',
  'baby': '婴儿',
  'back': '后面，背部',
  'bad': '坏的，糟糕的',
  'bag': '包，袋子',
  'ball': '球',
  'bank': '银行，岸',
  'base': '基础，基地',
  'be': '是，存在',
  'beat': '打败，敲打',
  'beautiful': '美丽的',
  'because': '因为',
  'become': '成为',
  'bed': '床',
  'before': '在...之前',
  'begin': '开始',
  'behavior': '行为，举止',
  'behind': '在...后面',
  'believe': '相信',
  'benefit': '好处，利益',
  'best': '最好的',
  'better': '更好的',
  'between': '在...之间',
  'beyond': '超越，在...那边',
  'big': '大的',
  'bill': '账单，法案',
  'billion': '十亿',
  'bit': '一点，位',
  'black': '黑色的',
  'blood': '血液',
  'blue': '蓝色的',
  'board': '板，董事会',
  'body': '身体',
  'book': '书',
  'born': '出生的',
  'both': '两者都',
  'box': '盒子',
  'boy': '男孩',
  'break': '打破，休息',
  'bring': '带来',
  'brother': '兄弟',
  'budget': '预算',
  'build': '建造',
  'building': '建筑物',
  'business': '商业，生意',
  'but': '但是',
  'buy': '购买',
  'by': '通过，被',
  'call': '叫，打电话',
  'camera': '相机',
  'campaign': '运动，活动',
  'can': '能够，罐头',
  'cancer': '癌症',
  'candidate': '候选人',
  'capital': '首都，资本',
  'car': '汽车',
  'card': '卡片',
  'care': '关心，照顾',
  'career': '职业，生涯',
  'carry': '携带，运送',
  'case': '情况，案例',
  'catch': '抓住，赶上',
  'cause': '原因，导致',
  'cell': '细胞，牢房',
  'center': '中心',
  'central': '中央的',
  'century': '世纪',
  'certain': '确定的，某些',
  'certainly': '当然，确实',
  'chair': '椅子，主席',
  'challenge': '挑战',
  'chance': '机会，可能性',
  'change': '改变，变化',
  'character': '性格，角色',
  'charge': '费用，指控',
  'check': '检查，支票',
  'child': '孩子',
  'choice': '选择',
  'choose': '选择',
  'church': '教堂',
  'citizen': '公民',
  'city': '城市',
  'civil': '公民的，民事的',
  'claim': '声称，索赔',
  'class': '班级，等级',
  'clear': '清楚的，清除',
  'clearly': '清楚地',
  'close': '关闭，接近',
  'coach': '教练',
  'cold': '冷的，感冒',
  'collection': '收藏，收集',
  'college': '大学，学院',
  'color': '颜色',
  'come': '来',
  'commercial': '商业的，广告',
  'common': '共同的，普通的',
  'community': '社区，群体',
  'company': '公司，陪伴',
  'compare': '比较',
  'computer': '电脑',
  'concern': '关心，担忧',
  'condition': '条件，状况',
  'conference': '会议',
  'congress': '国会，大会',
  'consider': '考虑，认为',
  'consumer': '消费者',
  'contain': '包含',
  'continue': '继续',
  'control': '控制',
  'cost': '成本，花费',
  'could': '能够（过去式）',
  'country': '国家，乡村',
  'couple': '夫妇，几个',
  'course': '课程，过程',
  'court': '法院，球场',
  'cover': '覆盖，封面',
  'create': '创造',
  'crime': '犯罪',
  'cultural': '文化的',
  'culture': '文化',
  'cup': '杯子',
  'current': '当前的，水流',
  'customer': '顾客',
  'cut': '切，削减',
  'dark': '黑暗的',
  'data': '数据',
  'daughter': '女儿',
  'day': '天，日子',
  'dead': '死的',
  'deal': '交易，处理',
  'death': '死亡',
  'debate': '辩论，讨论',
  'decade': '十年',
  'decide': '决定',
  'decision': '决定',
  'deep': '深的',
  'defense': '防御，辩护',
  'degree': '程度，学位',
  'democrat': '民主党人',
  'democratic': '民主的',
  'describe': '描述',
  'design': '设计',
  'despite': '尽管',
  'detail': '细节',
  'determine': '决定，确定',
  'develop': '发展，开发',
  'development': '发展，开发',
  'die': '死亡',
  'difference': '差异，不同',
  'different': '不同的',
  'difficult': '困难的',
  'dinner': '晚餐',
  'direction': '方向',
  'director': '导演，主任',
  'discover': '发现',
  'discuss': '讨论',
  'discussion': '讨论',
  'disease': '疾病',
  'do': '做',
  'doctor': '医生，博士',
  'dog': '狗',
  'door': '门',
  'down': '向下',
  'draw': '画，拉',
  'dream': '梦想，做梦',
  'drive': '驾驶，驱动',
  'drop': '落下，滴',
  'drug': '药物，毒品',
  'during': '在...期间',
  'each': '每个',
  'early': '早的，早期的',
  'east': '东方',
  'easy': '容易的',
  'eat': '吃',
  'economic': '经济的',
  'economy': '经济',
  'edge': '边缘',
  'education': '教育',
  'effect': '效果，影响',
  'effort': '努力',
  'eight': '八',
  'either': '任一，也',
  'election': '选举',
  'else': '其他，否则',
  'employee': '雇员',
  'end': '结束，末端',
  'energy': '能量，精力',
  'enjoy': '享受',
  'enough': '足够的',
  'enter': '进入',
  'entire': '整个的',
  'environment': '环境',
  'environmental': '环境的',
  'especially': '尤其，特别',
  'establish': '建立',
  'even': '甚至，平坦的',
  'evening': '晚上',
  'event': '事件，活动',
  'ever': '曾经',
  'every': '每个',
  'everybody': '每个人',
  'everyone': '每个人',
  'everything': '一切',
  'evidence': '证据',
  'exactly': '确切地',
  'example': '例子',
  'executive': '执行的，管理人员',
  'exist': '存在',
  'expect': '期望，预期',
  'experience': '经验，经历',
  'expert': '专家',
  'explain': '解释',
  'eye': '眼睛',
  'face': '脸，面对',
  'fact': '事实',
  'factor': '因素',
  'fail': '失败',
  'fall': '落下，秋天',
  'family': '家庭',
  'far': '远的',
  'fast': '快的',
  'father': '父亲',
  'fear': '恐惧',
  'federal': '联邦的',
  'feel': '感觉',
  'feeling': '感觉',
  'few': '少数的',
  'field': '领域，田野',
  'fight': '战斗，打架',
  'figure': '数字，人物',
  'fill': '填满',
  'film': '电影，胶卷',
  'final': '最终的',
  'finally': '最后',
  'financial': '金融的',
  'find': '发现，找到',
  'fine': '好的，罚款',
  'finger': '手指',
  'finish': '完成',
  'fire': '火，解雇',
  'firm': '公司，坚定的',
  'first': '第一',
  'fish': '鱼',
  'five': '五',
  'floor': '地板，楼层',
  'fly': '飞',
  'focus': '焦点，集中',
  'follow': '跟随',
  'food': '食物',
  'foot': '脚，英尺',
  'for': '为了',
  'force': '力量，强迫',
  'foreign': '外国的',
  'forget': '忘记',
  'form': '形式，表格',
  'former': '前者，以前的',
  'forward': '向前',
  'four': '四',
  'free': '自由的，免费的',
  'friend': '朋友',
  'from': '从',
  'front': '前面',
  'full': '满的，完整的',
  'fund': '基金，资金',
  'future': '未来',
  'game': '游戏，比赛',
  'garden': '花园',
  'gas': '气体，汽油',
  'general': '一般的，将军',
  'generation': '一代，产生',
  'get': '得到',
  'girl': '女孩',
  'give': '给',
  'glass': '玻璃，眼镜',
  'go': '去',
  'goal': '目标',
  'god': '上帝',
  'good': '好的',
  'government': '政府',
  'great': '伟大的，很棒的',
  'green': '绿色的',
  'ground': '地面，理由',
  'group': '组，群',
  'grow': '成长，种植',
  'growth': '成长，增长',
  'guess': '猜测',
  'gun': '枪',
  'guy': '家伙',
  'hair': '头发',
  'half': '一半',
  'hand': '手',
  'hang': '悬挂',
  'happen': '发生',
  'happy': '快乐的',
  'hard': '困难的，硬的',
  'have': '有',
  'he': '他',
  'head': '头，领导',
  'health': '健康',
  'hear': '听到',
  'heart': '心脏，心',
  'heat': '热量，加热',
  'heavy': '重的',
  'help': '帮助',
  'her': '她的',
  'here': '这里',
  'herself': '她自己',
  'high': '高的',
  'him': '他（宾格）',
  'himself': '他自己',
  'his': '他的',
  'history': '历史',
  'hit': '打，击中',
  'hold': '握住，举行',
  'home': '家',
  'hope': '希望',
  'hospital': '医院',
  'hot': '热的',
  'hotel': '酒店',
  'hour': '小时',
  'house': '房子',
  'how': '如何',
  'however': '然而',
  'huge': '巨大的',
  'human': '人类的',
  'hundred': '百',
  'husband': '丈夫',
  'idea': '想法，主意',
  'identify': '识别，确认',
  'if': '如果',
  'image': '图像，形象',
  'imagine': '想象',
  'impact': '影响，冲击',
  'important': '重要的',
  'improve': '改善',
  'in': '在...里',
  'include': '包括',
  'including': '包括',
  'increase': '增加',
  'indeed': '确实',
  'indicate': '表明',
  'individual': '个人，个体的',
  'industry': '工业，行业',
  'information': '信息',
  'inside': '里面',
  'instead': '代替，反而',
  'institution': '机构，制度',
  'interest': '兴趣，利息',
  'interesting': '有趣的',
  'international': '国际的',
  'interview': '面试，采访',
  'into': '进入',
  'investment': '投资',
  'involve': '涉及，参与',
  'issue': '问题，发行',
  'it': '它',
  'item': '项目，物品',
  'its': '它的',
  'itself': '它自己',
  'job': '工作',
  'join': '加入',
  'just': '只是，刚刚',
  'keep': '保持',
  'key': '钥匙，关键',
  'kid': '小孩',
  'kill': '杀死',
  'kind': '种类，善良的',
  'kitchen': '厨房',
  'know': '知道',
  'knowledge': '知识',
  'land': '土地，着陆',
  'language': '语言',
  'large': '大的',
  'last': '最后的，持续',
  'late': '晚的，迟的',
  'later': '后来',
  'laugh': '笑',
  'law': '法律',
  'lawyer': '律师',
  'lay': '放置，躺',
  'lead': '领导，铅',
  'leader': '领导者',
  'learn': '学习',
  'least': '最少的',
  'leave': '离开',
  'left': '左边，离开（过去式）',
  'leg': '腿',
  'legal': '法律的，合法的',
  'less': '更少的',
  'let': '让',
  'letter': '信，字母',
  'level': '水平，等级',
  'lie': '躺，说谎',
  'life': '生活，生命',
  'light': '光，轻的',
  'like': '喜欢，像',
  'likely': '可能的',
  'line': '线，排',
  'list': '列表',
  'listen': '听',
  'little': '小的，少的',
  'live': '生活，活的',
  'local': '当地的',
  'long': '长的',
  'look': '看',
  'lose': '失去，输',
  'loss': '损失',
  'lot': '许多',
  'love': '爱',
  'low': '低的',
  'machine': '机器',
  'magazine': '杂志',
  'main': '主要的',
  'maintain': '维持，保养',
  'major': '主要的，专业',
  'majority': '多数',
  'make': '制作，使',
  'man': '男人',
  'manage': '管理',
  'management': '管理',
  'manager': '经理',
  'many': '许多',
  'market': '市场',
  'marriage': '婚姻',
  'material': '材料',
  'matter': '事情，物质',
  'may': '可能，五月',
  'maybe': '也许',
  'me': '我（宾格）',
  'mean': '意思是，平均',
  'measure': '测量，措施',
  'media': '媒体',
  'medical': '医学的',
  'meet': '遇见，满足',
  'meeting': '会议',
  'member': '成员',
  'memory': '记忆',
  'mention': '提到',
  'message': '消息',
  'method': '方法',
  'middle': '中间',
  'might': '可能',
  'military': '军事的',
  'million': '百万',
  'mind': '头脑，介意',
  'minute': '分钟',
  'miss': '错过，想念',
  'mission': '使命，任务',
  'model': '模型，模特',
  'modern': '现代的',
  'moment': '时刻',
  'money': '钱',
  'month': '月',
  'more': '更多',
  'morning': '早晨',
  'most': '最多的',
  'mother': '母亲',
  'mouth': '嘴',
  'move': '移动',
  'movement': '运动，移动',
  'movie': '电影',
  'much': '很多',
  'music': '音乐',
  'must': '必须',
  'my': '我的',
  'myself': '我自己',
  'name': '名字',
  'nation': '国家，民族',
  'national': '国家的',
  'natural': '自然的',
  'nature': '自然',
  'near': '近的',
  'nearly': '几乎',
  'necessary': '必要的',
  'need': '需要',
  'network': '网络',
  'never': '从不',
  'new': '新的',
  'news': '新闻',
  'newspaper': '报纸',
  'next': '下一个',
  'nice': '好的，友好的',
  'night': '夜晚',
  'no': '不，没有',
  'none': '没有一个',
  'nor': '也不',
  'north': '北方',
  'not': '不',
  'note': '笔记，注意',
  'nothing': '没有什么',
  'notice': '注意，通知',
  'now': '现在',
  'number': '数字，号码',
  'occur': '发生',
  'of': '的',
  'off': '关，离开',
  'offer': '提供',
  'office': '办公室',
  'officer': '官员，军官',
  'official': '官方的，官员',
  'often': '经常',
  'oh': '哦',
  'oil': '油',
  'ok': '好的',
  'old': '老的，旧的',
  'on': '在...上',
  'once': '一次，曾经',
  'one': '一',
  'only': '只有，唯一的',
  'onto': '到...上',
  'open': '打开，开放的',
  'operation': '操作，手术',
  'opportunity': '机会',
  'option': '选择，选项',
  'or': '或者',
  'order': '命令，顺序',
  'organization': '组织',
  'other': '其他的',
  'others': '其他人',
  'our': '我们的',
  'out': '出',
  'outside': '外面',
  'over': '在...上方，结束',
  'own': '自己的，拥有',
  'owner': '所有者',
  'page': '页',
  'pain': '痛苦',
  'painting': '绘画',
  'paper': '纸，论文',
  'parent': '父母',
  'part': '部分',
  'participant': '参与者',
  'particular': '特别的',
  'particularly': '特别地',
  'partner': '伙伴',
  'party': '聚会，政党',
  'pass': '通过，传递',
  'past': '过去',
  'patient': '病人，耐心的',
  'pattern': '模式，图案',
  'pay': '支付',
  'peace': '和平',
  'people': '人们',
  'per': '每',
  'perform': '执行，表演',
  'performance': '表演，表现',
  'perhaps': '也许',
  'period': '时期，句号',
  'person': '人',
  'personal': '个人的',
  'phone': '电话',
  'physical': '物理的，身体的',
  'pick': '挑选，拾起',
  'picture': '图片',
  'piece': '片，件',
  'place': '地方，放置',
  'plan': '计划',
  'plant': '植物，工厂',
  'play': '玩，播放',
  'player': '运动员，播放器',
  'please': '请',
  'pm': '下午',
  'point': '点，观点',
  'police': '警察',
  'policy': '政策',
  'political': '政治的',
  'politics': '政治',
  'poor': '贫穷的',
  'popular': '流行的，受欢迎的',
  'population': '人口',
  'position': '位置，职位',
  'positive': '积极的，正面的',
  'possible': '可能的',
  'power': '力量，权力',
  'practice': '练习，实践',
  'prepare': '准备',
  'present': '现在的，礼物',
  'president': '总统，主席',
  'pressure': '压力',
  'pretty': '漂亮的，相当',
  'prevent': '阻止，预防',
  'price': '价格',
  'private': '私人的',
  'probably': '可能',
  'problem': '问题',
  'process': '过程，处理',
  'produce': '生产',
  'product': '产品',
  'production': '生产',
  'professional': '专业的',
  'professor': '教授',
  'program': '程序，节目',
  'project': '项目',
  'property': '财产，性质',
  'protect': '保护',
  'prove': '证明',
  'provide': '提供',
  'public': '公共的，公众',
  'pull': '拉',
  'purpose': '目的',
  'push': '推',
  'put': '放',
  'quality': '质量',
  'question': '问题',
  'quickly': '快速地',
  'quite': '相当',
  'race': '比赛，种族',
  'radio': '收音机',
  'raise': '提高，举起',
  'range': '范围',
  'rate': '率，速度',
  'rather': '宁可，相当',
  'reach': '达到，伸手',
  'read': '读',
  'ready': '准备好的',
  'real': '真实的',
  'reality': '现实',
  'realize': '意识到，实现',
  'really': '真正地',
  'reason': '原因，理由',
  'receive': '收到',
  'recent': '最近的',
  'recently': '最近',
  'recognize': '认出，承认',
  'record': '记录，唱片',
  'red': '红色的',
  'reduce': '减少',
  'reflect': '反映，反射',
  'region': '地区',
  'relate': '关联，叙述',
  'relationship': '关系',
  'religious': '宗教的',
  'remain': '保持，剩余',
  'remember': '记住',
  'remove': '移除',
  'report': '报告',
  'represent': '代表',
  'republican': '共和党的',
  'require': '需要，要求',
  'research': '研究',
  'resource': '资源',
  'respond': '回应',
  'response': '回应',
  'responsibility': '责任',
  'rest': '休息，其余',
  'result': '结果',
  'return': '返回',
  'reveal': '揭示',
  'rich': '富有的',
  'right': '右边，正确的',
  'rise': '上升',
  'risk': '风险',
  'road': '道路',
  'rock': '岩石，摇滚',
  'role': '角色',
  'room': '房间',
  'rule': '规则，统治',
  'run': '跑，运行',
  'safe': '安全的',
  'same': '相同的',
  'save': '保存，节省',
  'say': '说',
  'scene': '场景',
  'school': '学校',
  'science': '科学',
  'scientist': '科学家',
  'score': '分数',
  'sea': '海',
  'season': '季节',
  'seat': '座位',
  'second': '第二，秒',
  'section': '部分，章节',
  'security': '安全',
  'see': '看见',
  'seek': '寻求',
  'seem': '似乎',
  'sell': '卖',
  'send': '发送',
  'senior': '高级的，年长的',
  'sense': '感觉，意义',
  'series': '系列',
  'serious': '严肃的，严重的',
  'serve': '服务，服役',
  'service': '服务',
  'set': '设置，集合',
  'seven': '七',
  'several': '几个',
  'sex': '性别',
  'sexual': '性的',
  'shake': '摇晃',
  'shall': '将要',
  'shape': '形状',
  'share': '分享，股份',
  'she': '她',
  'shoot': '射击',
  'short': '短的',
  'shot': '射击，照片',
  'should': '应该',
  'shoulder': '肩膀',
  'show': '展示，节目',
  'side': '边，侧面',
  'sign': '标志，签名',
  'significant': '重要的，显著的',
  'similar': '相似的',
  'simple': '简单的',
  'simply': '简单地',
  'since': '自从',
  'sing': '唱歌',
  'single': '单一的，单身',
  'sister': '姐妹',
  'sit': '坐',
  'site': '地点，网站',
  'situation': '情况',
  'six': '六',
  'size': '大小',
  'skill': '技能',
  'skin': '皮肤',
  'small': '小的',
  'smile': '微笑',
  'so': '所以，如此',
  'social': '社会的',
  'society': '社会',
  'soldier': '士兵',
  'some': '一些',
  'somebody': '某人',
  'someone': '某人',
  'something': '某事',
  'sometimes': '有时',
  'son': '儿子',
  'song': '歌曲',
  'soon': '很快',
  'sort': '种类，排序',
  'sound': '声音',
  'source': '来源',
  'south': '南方',
  'southern': '南方的',
  'space': '空间',
  'speak': '说话',
  'special': '特别的',
  'specific': '具体的',
  'speech': '演讲',
  'spend': '花费',
  'sport': '运动',
  'spring': '春天，弹簧',
  'staff': '员工',
  'stage': '阶段，舞台',
  'stand': '站立',
  'standard': '标准',
  'star': '星星，明星',
  'start': '开始',
  'state': '状态，州',
  'statement': '声明',
  'station': '站',
  'stay': '停留',
  'step': '步骤，脚步',
  'still': '仍然',
  'stock': '股票，库存',
  'stop': '停止',
  'store': '商店，存储',
  'story': '故事',
  'strategy': '策略',
  'street': '街道',
  'strong': '强壮的',
  'structure': '结构',
  'student': '学生',
  'study': '学习，研究',
  'stuff': '东西',
  'style': '风格',
  'subject': '主题，学科',
  'success': '成功',
  'successful': '成功的',
  'such': '这样的',
  'suddenly': '突然',
  'suffer': '遭受',
  'suggest': '建议',
  'summer': '夏天',
  'support': '支持',
  'sure': '确定的',
  'surface': '表面',
  'system': '系统',
  'table': '桌子，表格',
  'take': '拿，带',
  'talk': '谈话',
  'task': '任务',
  'tax': '税',
  'teach': '教',
  'teacher': '老师',
  'team': '团队',
  'technology': '技术',
  'television': '电视',
  'tell': '告诉',
  'ten': '十',
  'tend': '倾向于',
  'term': '术语，学期',
  'test': '测试',
  'than': '比',
  'thank': '感谢',
  'that': '那个',
  'the': '这，那',
  'their': '他们的',
  'them': '他们（宾格）',
  'themselves': '他们自己',
  'then': '然后',
  'theory': '理论',
  'there': '那里',
  'these': '这些',
  'they': '他们',
  'thing': '事物',
  'think': '认为，想',
  'third': '第三',
  'this': '这个',
  'those': '那些',
  'though': '虽然',
  'thought': '思想，想法',
  'thousand': '千',
  'threat': '威胁',
  'three': '三',
  'through': '通过',
  'throughout': '遍及',
  'throw': '扔',
  'thus': '因此',
  'time': '时间',
  'to': '到',
  'today': '今天',
  'together': '一起',
  'tonight': '今晚',
  'too': '也，太',
  'top': '顶部',
  'total': '总共的',
  'tough': '艰难的',
  'toward': '朝向',
  'town': '城镇',
  'trade': '贸易，交易',
  'traditional': '传统的',
  'training': '训练',
  'travel': '旅行',
  'treat': '对待，治疗',
  'treatment': '治疗，处理',
  'tree': '树',
  'trial': '审判，试验',
  'trip': '旅行',
  'trouble': '麻烦',
  'true': '真实的',
  'truth': '真相',
  'try': '尝试',
  'turn': '转动，轮到',
  'tv': '电视',
  'two': '二',
  'type': '类型，打字',
  'under': '在...下面',
  'understand': '理解',
  'unit': '单位',
  'until': '直到',
  'up': '向上',
  'upon': '在...之上',
  'us': '我们（宾格）',
  'use': '使用',
  'usually': '通常',
  'value': '价值',
  'various': '各种各样的',
  'very': '非常',
  'victim': '受害者',
  'view': '观点，景色',
  'violence': '暴力',
  'visit': '访问',
  'voice': '声音',
  'vote': '投票',
  'wait': '等待',
  'walk': '走路',
  'wall': '墙',
  'want': '想要',
  'war': '战争',
  'watch': '观看，手表',
  'water': '水',
  'way': '方式，路',
  'we': '我们',
  'weapon': '武器',
  'wear': '穿',
  'week': '周',
  'weight': '重量',
  'well': '好，井',
  'west': '西方',
  'western': '西方的',
  'what': '什么',
  'whatever': '无论什么',
  'when': '当...时',
  'where': '哪里',
  'whether': '是否',
  'which': '哪个',
  'while': '当...时，虽然',
  'white': '白色的',
  'who': '谁',
  'whole': '整个的',
  'whom': '谁（宾格）',
  'whose': '谁的',
  'why': '为什么',
  'wide': '宽的',
  'wife': '妻子',
  'will': '将要，意志',
  'win': '赢',
  'wind': '风',
  'window': '窗户',
  'wish': '希望',
  'with': '与，用',
  'within': '在...之内',
  'without': '没有',
  'woman': '女人',
  'wonder': '想知道，奇迹',
  'word': '单词',
  'work': '工作',
  'worker': '工人',
  'world': '世界',
  'worry': '担心',
  'would': '会（过去式）',
  'write': '写',
  'writer': '作家',
  'wrong': '错误的',
  'yard': '院子，码',
  'yeah': '是的',
  'year': '年',
  'yes': '是的',
  'yet': '还，然而',
  'you': '你',
  'young': '年轻的',
  'your': '你的',
  'yourself': '你自己',
}

class DictionaryService {
  private baseUrl = 'https://api.dictionaryapi.dev/api/v2/entries/en'
  private cache = new Map<string, Word>()

  // 从 API 获取单词详情
  async fetchWord(word: string): Promise<Word | null> {
    // 检查缓存
    if (this.cache.has(word.toLowerCase())) {
      return this.cache.get(word.toLowerCase())!
    }

    try {
      const response = await fetch(`${this.baseUrl}/${encodeURIComponent(word)}`)
      
      if (!response.ok) {
        console.warn(`无法获取单词 "${word}" 的详情`)
        return this.createBasicWord(word)
      }

      const data: DictionaryResponse[] = await response.json()
      const wordData = this.transformResponse(data[0], word)
      
      // 缓存结果
      this.cache.set(word.toLowerCase(), wordData)
      
      return wordData
    } catch (error) {
      console.error(`获取单词 "${word}" 失败:`, error)
      return this.createBasicWord(word)
    }
  }

  // 转换 API 响应为应用内格式
  private transformResponse(data: DictionaryResponse, originalWord: string): Word {
    const meanings: Meaning[] = []
    const examples: string[] = []
    const synonyms: string[] = []
    const antonyms: string[] = []

    for (const meaning of data.meanings) {
      for (const def of meaning.definitions.slice(0, 2)) {
        meanings.push({
          partOfSpeech: meaning.partOfSpeech,
          definition: def.definition,
          translation: commonTranslations[originalWord.toLowerCase()] || '待翻译',
        })
        if (def.example) {
          examples.push(def.example)
        }
        if (def.synonyms) {
          synonyms.push(...def.synonyms.slice(0, 3))
        }
        if (def.antonyms) {
          antonyms.push(...def.antonyms.slice(0, 3))
        }
      }
      if (meaning.synonyms) {
        synonyms.push(...meaning.synonyms.slice(0, 3))
      }
      if (meaning.antonyms) {
        antonyms.push(...meaning.antonyms.slice(0, 3))
      }
    }

    // 获取音标
    const usPhonetic = data.phonetics.find(p => p.audio?.includes('us'))?.text || data.phonetics[0]?.text || ''
    const ukPhonetic = data.phonetics.find(p => p.audio?.includes('uk'))?.text || usPhonetic

    return {
      id: `dict_${originalWord.toLowerCase()}_${Date.now()}`,
      word: data.word,
      phonetic: {
        us: usPhonetic,
        uk: ukPhonetic,
      },
      meanings: meanings.slice(0, 3),
      examples: examples.slice(0, 3),
      synonyms: [...new Set(synonyms)].slice(0, 5),
      antonyms: [...new Set(antonyms)].slice(0, 5),
      collocations: [],
      frequency: 'medium',
      tags: ['词典API'],
    }
  }

  // 创建基础单词（当 API 失败时）
  private createBasicWord(word: string): Word {
    return {
      id: `basic_${word.toLowerCase()}_${Date.now()}`,
      word: word,
      phonetic: { us: '', uk: '' },
      meanings: [{
        partOfSpeech: 'unknown',
        definition: '',
        translation: commonTranslations[word.toLowerCase()] || '待补充',
      }],
      examples: [],
      synonyms: [],
      antonyms: [],
      collocations: [],
      frequency: 'medium',
      tags: ['基础词汇'],
    }
  }

  // 批量获取单词
  async fetchWords(words: string[], onProgress?: (current: number, total: number) => void): Promise<Word[]> {
    const results: Word[] = []
    const total = words.length

    for (let i = 0; i < words.length; i++) {
      const word = await this.fetchWord(words[i])
      if (word) {
        results.push(word)
      }
      onProgress?.(i + 1, total)
      
      // 添加小延迟避免 API 限流
      if (i < words.length - 1) {
        await new Promise(resolve => setTimeout(resolve, 100))
      }
    }

    return results
  }
}

export const dictionaryService = new DictionaryService()
